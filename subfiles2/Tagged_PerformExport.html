Formatted_PerformExport.html<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><title>ExportFormat.java</title></head>
<body>
<line class = "comment" >1 &nbsp;<comment type="block" format="javadoc">/**<br/>
 &nbsp;* Perform the export of {@code database}.<br/>
 &nbsp;*<br/>
 &nbsp;* @param database<br/>
 &nbsp;*            The database to export from.<br/>
 &nbsp;* @param metaData<br/>
 &nbsp;*            The database's meta data.<br/>
 &nbsp;* @param file<br/>
 &nbsp;*            the file to write the resulting export to<br/>
 &nbsp;* @param encoding<br/>
 &nbsp;*            The encoding of the database<br/>
 &nbsp;* @param entryIds<br/>
 &nbsp;*            Contains the IDs of all entries that should be exported. If<br/>
 &nbsp;*            &lt;code&gt;null&lt;/code&gt;, all entries will be exported.<br/>
 &nbsp;*<br/>
 &nbsp;* @throws IOException<br/>
 &nbsp;*             if a problem occurred while trying to write to {@code writer}<br/>
 &nbsp;*             or read from required resources.<br/>
 &nbsp;* @throws Exception<br/>
 &nbsp;*             if any other error occurred during export.<br/>
 &nbsp;*<br/>
 &nbsp;* @see net.sf.jabref.exporter.IExportFormat#performExport(BibDatabase,<br/>
 &nbsp;*      net.sf.jabref.MetaData, java.lang.String, java.lang.String, java.util.Set)<br/>
 &nbsp;*/</comment><br/></line>
<line class = "methodSg">2   &nbsp;<function><annotation>@<name>Override</name></annotation><br/></line>
<line class = "methodSg">3   &nbsp;<specifier>public</specifier> <type><name>void</name></type> <name>performExport</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>BibDatabase</name></type> <name>database</name></decl></parameter>,<br/>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<parameter><decl><type><specifier>final</specifier> <name>MetaData</name></type> <name>metaData</name></decl></parameter>, <parameter><decl><type><specifier>final</specifier> <name>String</name></type> <name>file</name></decl></parameter>,<br/>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<parameter><decl><type><specifier>final</specifier> <name>Charset</name></type> <name>enc</name></decl></parameter>, <parameter><decl><type><name><name>Set</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name></type> <name>entryIds</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<br/></line>
<line class = "nothing" >4   &nbsp;<br/></line>
<line class = "decl"    >5   &nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>File</name></type> <name>outFile</name> <init>= <expr><operator>new</operator> <call><name>File</name><argument_list>(<argument><expr><name>file</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt><br/></line>
<line class = "decl"    >6   &nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>SaveSession</name></type> <name>ss</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt><br/></line>
<line class = "controlS">7   &nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><name><name>this</name><operator>.</operator><name>encoding</name></name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><then> <block>{<br/></line>
<line class = "try"     >8   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<try>try <block>{<br/></line>
<line class = "methodC" >9   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>ss</name> <operator>=</operator> <call><name>getSaveSession</name><argument_list>(<argument><expr><name><name>this</name><operator>.</operator><name>encoding</name></name></expr></argument>, <argument><expr><name>outFile</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "catch"   >10  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<br/></line>
<line class = "comment" >11  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Perhaps the overriding encoding doesn't work?</comment><br/></line>
<line class = "comment" >12  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// We will fall back on the default encoding.</comment><br/></line>
<line class = "printE"  >13  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>LOGGER</name><operator>.</operator><name>warn</name></name><argument_list>(<argument><expr><literal type="string">"Can not get save session."</literal></expr></argument>, <argument><expr><name>ex</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >14  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></catch></try><br/></line>
<line class = "nothing" >15  &nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "controlS">16  &nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><name>ss</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><then> <block>{<br/></line>
<line class = "methodC" >17  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>ss</name> <operator>=</operator> <call><name>getSaveSession</name><argument_list>(<argument><expr><name>enc</name></expr></argument>, <argument><expr><name>outFile</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >18  &nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "nothing" >19  &nbsp;<br/></line>
<line class = "try"     >20  &nbsp;&nbsp;&nbsp;&nbsp;<try>try <init>(<decl><type><name>VerifyingWriter</name></type> <name>ps</name> <init>= <expr><call><name><name>ss</name><operator>.</operator><name>getWriter</name></name><argument_list>()</argument_list></call></expr></init></decl>)</init> <block>{<br/></line>
<line class = "nothing" >21  &nbsp;<br/></line>
<line class = "decl"    >22  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>Layout</name></type> <name>beginLayout</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt><br/></line>
<line class = "nothing" >23  &nbsp;<br/></line>
<line class = "comment" >24  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Check if this export filter has bundled name formatters:</comment><br/></line>
<line class = "comment" >25  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Set a global field, so all layouts have access to the custom name formatters:</comment><br/></line>
<line class = "mehtodC">26  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name><name>Globals</name><operator>.</operator><name>prefs</name><operator>.</operator><name>customExportNameFormatters</name></name> <operator>=</operator> <call><name>readFormatterFile</name><argument_list>(<argument><expr><name>lfFileName</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >27  &nbsp;<br/></line>
<line class = "decl"    >28  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name></type> <name>missingFormatters</name> <init>= <expr><operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;&gt;</argument_list></name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt><br/></line>
<line class = "nothing" >29  &nbsp;<br/></line>
<line class = "comment" >30  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Print header</comment><br/></line>
<line class = "try"     >31  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<try>try <init>(<decl><type><name>Reader</name></type> <name>reader</name> <init>= <expr><call><name>getReader</name><argument_list>(<argument><expr><name>lfFileName</name> <operator>+</operator> <literal type="string">".begin.layout"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<br/></line>
<line  class = "decl">32  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>LayoutHelper</name></type> <name>layoutHelper</name> <init>= <expr><operator>new</operator> <call><name>LayoutHelper</name><argument_list>(<argument><expr><name>reader</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt><br/></line>
<line class = "methodC" >33  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>beginLayout</name> <operator>=</operator> <call><name><name>layoutHelper</name><operator>.</operator><name>getLayoutFromText</name></name><argument_list>(<argument><expr><name><name>Globals</name><operator>.</operator><name>FORMATTER_PACKAGE</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "catch"   >34  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></try> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<br/></line>
<line class = "comment" >35  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// If an exception was cast, export filter doesn't have a begin</comment><br/></line>
<line class = "comment" >36  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// file.</comment><br/></line>
<line class = "nothing" >37  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></catch><br/></line>
<line class = "comment" >38  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Write the header</comment><br/></line>
<line class = "controlS">39  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><name>beginLayout</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><then> <block>{<br/></line>
<line class = "methodC" >40  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>ps</name><operator>.</operator><name>write</name></name><argument_list>(<argument><expr><call><name><name>beginLayout</name><operator>.</operator><name>doLayout</name></name><argument_list>(<argument><expr><name>database</name></expr></argument>, <argument><expr><name>enc</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "methodC" >41  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>missingFormatters</name><operator>.</operator><name>addAll</name></name><argument_list>(<argument><expr><call><name><name>beginLayout</name><operator>.</operator><name>getMissingFormatters</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >42  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "nothing" >43  &nbsp;<br/></line>
<line class = "nothing" >44  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="block">/*<br/></line>
<line class = "comment" >45  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Write database entries; entries will be sorted as they appear on the<br/></line>
<line class = "comment"46  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * screen, or sorted by author, depending on Preferences. We also supply<br/></line>
<line class = "comment" >47  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * the Set entries - if we are to export only certain entries, it will<br/></line>
<line class = "comment" >48  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * be non-null, and be used to choose entries. Otherwise, it will be<br/></line>
<line class = "comment" >49  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * null, and be ignored.<br/></line>
<line class = "comment" >50  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</comment><br/></line>
<line class = "decl"    >51  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>BibEntry</name></argument>&gt;</argument_list></name></type> <name>sorted</name> <init>= <expr><call><name><name>FileActions</name><operator>.</operator><name>getSortedEntries</name></name><argument_list>(<argument><expr><name>database</name></expr></argument>, <argument><expr><name>metaData</name></expr></argument>, <argument><expr><name>entryIds</name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt><br/></line>
<line class = "nothing" >52  &nbsp;<br/></line>
<line class = "comment" >53  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Load default layout</comment><br/></line>
<line class = "decl"    >54  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>Layout</name></type> <name>defLayout</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt><br/></line>
<line class = "decl"    >55  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>LayoutHelper</name></type> <name>layoutHelper</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt><br/></line>
<line class = "try"     >56  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<try>try <init>(<decl><type><name>Reader</name></type> <name>reader</name> <init>= <expr><call><name>getReader</name><argument_list>(<argument><expr><name>lfFileName</name> <operator>+</operator> <literal type="string">".layout"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<br/></line>
<line class = "Asignmt">57  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>layoutHelper</name> <operator>=</operator> <operator>new</operator> <call><name>LayoutHelper</name><argument_list>(<argument><expr><name>reader</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "methodC" >58  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>defLayout</name> <operator>=</operator> <call><name><name>layoutHelper</name><operator>.</operator><name>getLayoutFromText</name></name><argument_list>(<argument><expr><name><name>Globals</name><operator>.</operator><name>FORMATTER_PACKAGE</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >59  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></try><br/></line>
<line class = "controlS">60  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><name>defLayout</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><then> <block>{<br/></line>
<line class = "methodC" >61  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>missingFormatters</name><operator>.</operator><name>addAll</name></name><argument_list>(<argument><expr><call><name><name>defLayout</name><operator>.</operator><name>getMissingFormatters</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "printE">62  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>LOGGER</name><operator>.</operator><name>warn</name></name><argument_list>(<argument><expr><call><name><name>defLayout</name><operator>.</operator><name>getMissingFormatters</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >63  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "decl"    >64  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name><name>HashMap</name><argument_list type="generic">&lt;<argument><name>String</name></argument>, <argument><name>Layout</name></argument>&gt;</argument_list></name></type> <name>layouts</name> <init>= <expr><operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt><br/></line>
<line class = "decl"    >65  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>Layout</name></type> <name>layout</name></decl>;</decl_stmt><br/></line>
<line class = "nothing" >66  &nbsp;<br/></line>
<line class = "Asignmt">67  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name><name>ExportFormats</name><operator>.</operator><name>entryNumber</name></name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt><br/></line>
<line class = "for">68  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<for>for <control>(<init><decl><type><name>BibEntry</name></type> <name>entry</name> <range>: <expr><name>sorted</name></expr></range></decl></init>)</control> <block>{<br/></line>
<line class = "expr">69  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name><name>ExportFormats</name><operator>.</operator><name>entryNumber</name></name><operator>++</operator></expr>;</expr_stmt> <comment type="line">// Increment entry counter.</comment><br/></line>
<line class = "nothing" >70  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Get the layout</comment><br/></line>
<line class = "methodC" >71  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>String</name></type> <name>type</name> <init>= <expr><call><name><name>entry</name><operator>.</operator><name>getType</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getName</name><argument_list>()</argument_list></call><operator>.</operator><call><name>toLowerCase</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt><br/></line>
<line class = "controlS">72  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><call><name><name>layouts</name><operator>.</operator><name>containsKey</name></name><argument_list>(<argument><expr><name>type</name></expr></argument>)</argument_list></call></expr>)</condition><then> <block>{<br/></line>
<line class = "expr">73  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>layout</name> <operator>=</operator> <call><name><name>layouts</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name>type</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "conrolS">74  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></then> <else>else <block>{<br/></line>
<line class = "try"     >75  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<try>try <init>(<decl><type><name>Reader</name></type> <name>reader</name> <init>= <expr><call><name>getReader</name><argument_list>(<argument><expr><name>lfFileName</name> <operator>+</operator> <literal type="char">'.'</literal> <operator>+</operator> <name>type</name> <operator>+</operator> <literal type="string">".layout"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<br/></line>
<line class = "comment" >76  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// We try to get a type-specific layout for this entry.</comment><br/></line>
<line class = "decl"    >77  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>layoutHelper</name> <operator>=</operator> <operator>new</operator> <call><name>LayoutHelper</name><argument_list>(<argument><expr><name>reader</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "methodC" >78  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>layout</name> <operator>=</operator> <call><name><name>layoutHelper</name><operator>.</operator><name>getLayoutFromText</name></name><argument_list>(<argument><expr><name><name>Globals</name><operator>.</operator><name>FORMATTER_PACKAGE</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "methodC" >79  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>layouts</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><name>type</name></expr></argument>, <argument><expr><name>layout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "controlS">80  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><name>layout</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><then> <block>{<br/></line>
<line class = "methodC" >81  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>missingFormatters</name><operator>.</operator><name>addAll</name></name><argument_list>(<argument><expr><call><name><name>layout</name><operator>.</operator><name>getMissingFormatters</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >82  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "nothing" >83  &nbsp;<br/></line>
<line class = "catch"   >84  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></try> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<br/></line>
<line class = "comment" >85  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// The exception indicates that no type-specific layout</comment><br/></line>
<line class = "comment" >86  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// exists, so we</comment><br/></line>
<line class = "comment" >87  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// go with the default one.</comment><br/></line>
<line class = "Asignmt">88  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>layout</name> <operator>=</operator> <name>defLayout</name></expr>;</expr_stmt><br/></line>
<line class = "nothing" >89  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></catch><br/></line>
<line class = "nothing" >90  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></else></if><br/></line>
<line class = "nothing" >91  &nbsp;<br/></line>
<line class = "comment" >92  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Write the entry</comment><br/></line>
<line class = "methodC" >93  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>ps</name><operator>.</operator><name>write</name></name><argument_list>(<argument><expr><call><name><name>layout</name><operator>.</operator><name>doLayout</name></name><argument_list>(<argument><expr><name>entry</name></expr></argument>, <argument><expr><name>database</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >94  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></for><br/></line>
<line class = "nothing" >95  &nbsp;<br/></line>
<line class = "comment" >96  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Print footer</comment><br/></line>
<line class = "nothing" >97  &nbsp;<br/></line>
<line class = "comment" >98  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// changed section - begin (arudert)</comment><br/></line>
<line class = "decl"    >99  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>Layout</name></type> <name>endLayout</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt><br/></line>
<line class = "try"     >100 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<try>try <init>(<decl><type><name>Reader</name></type> <name>reader</name> <init>= <expr><call><name>getReader</name><argument_list>(<argument><expr><name>lfFileName</name> <operator>+</operator> <literal type="string">".end.layout"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<br/></line>
<line class = "decl"    >101 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>layoutHelper</name> <operator>=</operator> <operator>new</operator> <call><name>LayoutHelper</name><argument_list>(<argument><expr><name>reader</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "expr">102 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name>endLayout</name> <operator>=</operator> <call><name><name>layoutHelper</name><operator>.</operator><name>getLayoutFromText</name></name><argument_list>(<argument><expr><name><name>Globals</name><operator>.</operator><name>FORMATTER_PACKAGE</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "catch"   >103 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></try> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<br/></line>
<line class = "comment" >104 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// If an exception was thrown, export filter doesn't have an end</comment><br/></line>
<line class = "comment" >105 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// file.</comment><br/></line>
<line class = "nothing" >106 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></catch><br/></line>
<line class = "nothing" >107 &nbsp;<br/></line>
<line class = "comment" >108 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Write footer</comment><br/></line>
<line class = "controlS">109 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><name>endLayout</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><then> <block>{<br/></line>
<line class = "methodC" >110 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>ps</name><operator>.</operator><name>write</name></name><argument_list>(<argument><expr><call><name><name>endLayout</name><operator>.</operator><name>doLayout</name></name><argument_list>(<argument><expr><name>database</name></expr></argument>, <argument><expr><name>encoding</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "methodC" >111 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>missingFormatters</name><operator>.</operator><name>addAll</name></name><argument_list>(<argument><expr><call><name><name>endLayout</name><operator>.</operator><name>getMissingFormatters</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >112 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "nothing" >113 &nbsp;<br/></line>
<line class = "comment" >114 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<comment type="line">// Clear custom name formatters:</comment><br/></line>
<line class = "expr">115 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><name><name>Globals</name><operator>.</operator><name>prefs</name><operator>.</operator><name>customExportNameFormatters</name></name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt><br/></line>
<line class = "nothing" >116 &nbsp;<br/></line>
<line class = "controlS">117 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><operator>!</operator><call><name><name>missingFormatters</name><operator>.</operator><name>isEmpty</name></name><argument_list>()</argument_list></call></expr>)</condition><then> <block>{<br/></line>
<line class = "decl"    >118 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<decl_stmt><decl><type><name>StringBuilder</name></type> <name>sb</name> <init>= <expr><operator>new</operator> <call><name>StringBuilder</name><argument_list>(<argument><expr><literal type="string">"The following formatters could not be found"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>append</name><argument_list>(<argument><expr><literal type="string">": "</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt><br/></line>
<line class = "for">119 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<for>for <control>(<init><decl><type><name><name>Iterator</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name></type> <name>i</name> <init>= <expr><call><name><name>missingFormatters</name><operator>.</operator><name>iterator</name></name><argument_list>()</argument_list></call></expr></init></decl>;</init> <condition><expr><call><name><name>i</name><operator>.</operator><name>hasNext</name></name><argument_list>()</argument_list></call></expr>;</condition><incr/>)</control> <block>{<br/></line>
<line class = "expr">120 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><call><name><name>i</name><operator>.</operator><name>next</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "controlS">121 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<if>if <condition>(<expr><call><name><name>i</name><operator>.</operator><name>hasNext</name></name><argument_list>()</argument_list></call></expr>)</condition><then> <block>{<br/></line>
<line class = "methodC" >122 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><literal type="string">", "</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >123 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "nothing" >124 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></for><br/></line>
<line class = "printE">125 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name><name>LOGGER</name><operator>.</operator><name>warn</name></name><argument_list>(<argument><expr><name>sb</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >126 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</block></then></if><br/></line>
<line class = "methodC" >127 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<expr_stmt><expr><call><name>finalizeSaveSession</name><argument_list>(<argument><expr><name>ss</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><br/></line>
<line class = "nothing" >128 &nbsp;&nbsp;&nbsp;&nbsp;}</block></try><br/></line>
<line class = "nothing" >129 &nbsp;<br/></line>
<line class = "nothing" >130 &nbsp;}</block></function><br/>
</body></html>
